


/*
 * Copyright (C) 2007-2011 Siemens AG
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published
 * by the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public License
 * along with this program. If not, see <http://www.gnu.org/licenses/>.
 */

/*******************************************************************
 *
 * @author Sebastian.Kaebisch.EXT@siemens.com
 * @version 0.5
 * @contact Joerg.Heuer@siemens.com
 *
 * <p>Code generated by EXISeGen</p>
 *
 ********************************************************************/


#include "v2g_service.h"
#include "v2g_serviceDispatcher.h"
#include "v2g_serviceDataTypes.h"
#include "v2g_serviceDataTypes.c"
#include "v2g_serviceMethods.h"
#include "v2g_serviceDataSerialization.c"
#include "EXITypes.h"
#include "EXIDecoder.h"
#include "EXIEncoder.h"
#include "StringTable.h"
#include <string.h>


static int deserializeMessage(struct EXIService* service);


static int _setInt32Value(integer_t* iv, int32_t* int32) {
	int errn = 0;
	switch(iv->type) {
	/* Unsigned Integer */
	case UNSIGNED_INTEGER_8:
		*int32 = iv->val.uint8;
		break;
	case UNSIGNED_INTEGER_16:
		*int32 = iv->val.uint16;
		break;
	case UNSIGNED_INTEGER_32:
		if (iv->val.uint32 <= 2147483647) {
			*int32 = iv->val.uint32;
		} else {
			errn = EXI_UNSUPPORTED_INTEGER_VALUE;
		}
		break;
	case UNSIGNED_INTEGER_64:
		errn = EXI_UNSUPPORTED_INTEGER_VALUE;
		break;
	/* (Signed) Integer */
	case INTEGER_8:
		*int32 = iv->val.int8;
		break;
	case INTEGER_16:
		*int32 = iv->val.int16;
		break;
	case INTEGER_32:
		*int32 = iv->val.int32;
		break;
	case INTEGER_64:
		errn = EXI_UNSUPPORTED_INTEGER_VALUE;
	}
	return errn;
}

static int _setInt16Value(integer_t* iv, int16_t* int16) {
	int errn = 0;
	switch(iv->type) {
	/* Unsigned Integer */
	case UNSIGNED_INTEGER_8:
		*int16 = iv->val.uint8;
		break;
	case UNSIGNED_INTEGER_16:
		*int16 = iv->val.uint16;
		break;
	case UNSIGNED_INTEGER_32:
		if (iv->val.uint32 <= 2147483647) {
			*int16 = iv->val.uint32;
		} else {
			errn = EXI_UNSUPPORTED_INTEGER_VALUE;
		}
		break;
	case UNSIGNED_INTEGER_64:
		errn = EXI_UNSUPPORTED_INTEGER_VALUE;
		break;
	/* (Signed) Integer */
	case INTEGER_8:
		*int16 = iv->val.int8;
		break;
	case INTEGER_16:
		*int16 = iv->val.int16;
		break;
	case INTEGER_32:
		*int16 = iv->val.int32;
		break;
	case INTEGER_64:
		errn = EXI_UNSUPPORTED_INTEGER_VALUE;
	}
	return errn;
}

/**
 * Deserialize an element value of the EXI stream and assign it to the
 * service data structure 
 */
static int deserializeElementCharacter(struct EXIService* service)
{

	switch(service->eqn.namespaceURI) {
		case 0:
			switch(service->eqn.localPart) {
				case 0: /*attr_Algorithm*/
		if(service->val.type == STRING) 
					{
						if( service->idPath.id[5] == 0)
						{
							memcpy(service->exiMsg.V2G_Message.Header->Security.Signature->SignedInfo.CanonicalizationMethod.attr_Algorithm.data, service->val.string.codepoints,service->val.string.len*sizeof(uint32_t));
						service->exiMsg.V2G_Message.Header->Security.Signature->SignedInfo.CanonicalizationMethod.attr_Algorithm.arraylen.data = service->val.string.len;

						} else if(service->idPath.id[5] == 43)
						{
							memcpy(service->exiMsg.V2G_Message.Header->Security.Signature->SignedInfo.SignatureMethod.attr_Algorithm.data, service->val.string.codepoints,service->val.string.len*sizeof(uint32_t));
						service->exiMsg.V2G_Message.Header->Security.Signature->SignedInfo.SignatureMethod.attr_Algorithm.arraylen.data = service->val.string.len;

						} else if(service->idPath.id[6] == 5)
						{
					/*		memcpy(service->exiMsg.V2G_Message.Header->Security.Signature.SignedInfo.Reference[service->exiMsg.V2G_Message.Header->Security.Signature.SignedInfo.arraylen.Reference].DigestMethod.attr_Algorithm.data, service->val.string.codepoints,service->val.string.len*sizeof(uint32_t));
						service->exiMsg.V2G_Message.Header->Security.Signature.SignedInfo.Reference[service->exiMsg.V2G_Message.Header->Security.Signature.SignedInfo.arraylen.Reference].DigestMethod.attr_Algorithm.arraylen.data = service->val.string.len; */
						}


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 2: /*attr_Id*/
		if(service->val.type == STRING) 
					{
						if( service->idPath.id[3] == 42)
						{
							memcpy(service->exiMsg.V2G_Message.Header->Security.Signature->attr_Id.data, service->val.string.codepoints,service->val.string.len*sizeof(uint32_t));
						service->exiMsg.V2G_Message.Header->Security.Signature->attr_Id.arraylen.data = service->val.string.len;

						} else if(service->idPath.id[4] == 52)
						{
							/*memcpy(service->exiMsg.V2G_Message.Header->Security.Signature->SignedInfo.attr_Id.data, service->val.string.codepoints,service->val.string.len*sizeof(uint32_t));
						service->exiMsg.V2G_Message.Header->Security.Signature->SignedInfo->attr_Id.arraylen.data = service->val.string.len;
*/
						} else if(service->idPath.id[4] == 50)
						{
						/*	memcpy(service->exiMsg.V2G_Message.Header->Security.Signature->SignatureValue.attr_Id.data, service->val.string.codepoints,service->val.string.len*sizeof(uint32_t));
						service->exiMsg.V2G_Message.Header->Security->Signature.SignatureValue.attr_Id.arraylen.data = service->val.string.len;
*/
						} else if(service->idPath.id[4] == 14)
						{
							memcpy(service->exiMsg.V2G_Message.Header->Security.Signature->KeyInfo.attr_Id.data, service->val.string.codepoints,service->val.string.len*sizeof(uint32_t));
						service->exiMsg.V2G_Message.Header->Security.Signature->KeyInfo.attr_Id.arraylen.data = service->val.string.len;

						} else if(service->idPath.id[5] == 34)
						{
/*							memcpy(service->exiMsg.V2G_Message.Header->Security.Signature.SignedInfo.Reference[service->exiMsg.V2G_Message.Header->Security.Signature.SignedInfo.arraylen.Reference].attr_Id.data, service->val.string.codepoints,service->val.string.len*sizeof(uint32_t));
						service->exiMsg.V2G_Message.Header->Security.Signature.SignedInfo.Reference[service->exiMsg.V2G_Message.Header->Security.Signature.SignedInfo.arraylen.Reference].attr_Id.arraylen.data = service->val.string.len; */
						}


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 6: /*attr_URI*/
		if(service->val.type == STRING) 
					{
						/*memcpy(service->exiMsg.V2G_Message.Header->Security.Signature.SignedInfo.Reference[service->exiMsg.V2G_Message.Header->Security.Signature.SignedInfo.arraylen.Reference].attr_URI.data, service->val.string.codepoints,service->val.string.len*sizeof(uint32_t));
						service->exiMsg.V2G_Message.Header->Security.Signature.SignedInfo.Reference[service->exiMsg.V2G_Message.Header->Security.Signature.SignedInfo.arraylen.Reference].attr_URI.arraylen.data = service->val.string.len; */


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 5: /*attr_Type*/
		if(service->val.type == STRING) 
					{
					/*	memcpy(service->exiMsg.V2G_Message.Header->Security.Signature.SignedInfo.Reference[service->exiMsg.V2G_Message.Header->Security.Signature.SignedInfo.arraylen.Reference].attr_Type.data, service->val.string.codepoints,service->val.string.len*sizeof(uint32_t));
						service->exiMsg.V2G_Message.Header->Security.Signature.SignedInfo.Reference[service->exiMsg.V2G_Message.Header->Security.Signature.SignedInfo.arraylen.Reference].attr_Type.arraylen.data = service->val.string.len; */


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;	
			} /* close switch(service->eqn.localPart) */	
		break;
		case 4:
			switch(service->eqn.localPart) {
				case 7: /*DigestValue*/
		if(service->val.type == BINARY_BASE64) 
		{
						memcpy(service->exiMsg.V2G_Message.Header->Security.Signature->SignedInfo.Reference.DigestValue.data, service->val.binary.data,service->val.binary.len);
						service->exiMsg.V2G_Message.Header->Security.Signature->SignedInfo.Reference.DigestValue.arraylen.data = service->val.binary.len;


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 50: /*SignatureValue*/

				if(service->val.type == BINARY_BASE64)
				{
					memcpy(service->exiMsg.V2G_Message.Header->Security.Signature->SignatureValue.data, service->val.binary.data,service->val.binary.len);
					service->exiMsg.V2G_Message.Header->Security.Signature->SignatureValue.arraylen.data = service->val.binary.len;


				}
				else
				{
					return -1; /* wrong data type */
				}


				break;
				case 62: /*X509IssuerName*/
		if(service->val.type == STRING) 
					{
						memcpy(service->exiMsg.V2G_Message.Header->Security.Signature->KeyInfo.X509Data.X509IssuerSerial.X509IssuerName.data, service->val.string.codepoints,service->val.string.len*sizeof(uint32_t));
						service->exiMsg.V2G_Message.Header->Security.Signature->KeyInfo.X509Data.X509IssuerSerial.X509IssuerName.arraylen.data = service->val.string.len;


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 66: /*X509SerialNumber*/
		if(service->val.type == INTEGER) 
					{
						service->exiMsg.V2G_Message.Header->Security.Signature->KeyInfo.X509Data.X509IssuerSerial.X509SerialNumber = service->val.integer.val.int64;


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 65: /*X509SKI*/
		if(service->val.type == BINARY_BASE64) 
					{
						memcpy(service->exiMsg.V2G_Message.Header->Security.Signature->KeyInfo.X509Data.X509SKI.data, service->val.binary.data,service->val.binary.len);
						service->exiMsg.V2G_Message.Header->Security.Signature->KeyInfo.X509Data.X509SKI.arraylen.data = service->val.binary.len;


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 67: /*X509SubjectName*/
		if(service->val.type == STRING) 
					{
						memcpy(service->exiMsg.V2G_Message.Header->Security.Signature->KeyInfo.X509Data.X509SubjectName.data, service->val.string.codepoints,service->val.string.len*sizeof(uint32_t));
						service->exiMsg.V2G_Message.Header->Security.Signature->KeyInfo.X509Data.X509SubjectName.arraylen.data = service->val.string.len;


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 59: /*X509Certificate*/
		if(service->val.type == BINARY_BASE64) 
					{
						memcpy(service->exiMsg.V2G_Message.Header->Security.Signature->KeyInfo.X509Data.X509Certificate.data, service->val.binary.data,service->val.binary.len);
						service->exiMsg.V2G_Message.Header->Security.Signature->KeyInfo.X509Data.X509Certificate.arraylen.data = service->val.binary.len;


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 58: /*X509CRL*/
		if(service->val.type == BINARY_BASE64) 
					{
						memcpy(service->exiMsg.V2G_Message.Header->Security.Signature->KeyInfo.X509Data.X509CRL.data, service->val.binary.data,service->val.binary.len);
						service->exiMsg.V2G_Message.Header->Security.Signature->KeyInfo.X509Data.X509CRL.arraylen.data = service->val.binary.len;


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;	
			} /* close switch(service->eqn.localPart) */	
		break;
		case 5:
			switch(service->eqn.localPart) {
				case 68: /*PEVID*/
		if(service->val.type == STRING) 
					{
						if( service->idPath.id[2] == 114)
						{
							memcpy(service->exiMsg.V2G_Message.Body.SessionSetupReq->PEVID.data, service->val.string.codepoints,service->val.string.len*sizeof(uint32_t));
						service->exiMsg.V2G_Message.Body.SessionSetupReq->PEVID.arraylen.data = service->val.string.len;
						service->exiMsg.V2G_Message.Body.SessionSetupReq->isused.PEVID=1;

						} else if(service->idPath.id[2] == 57)
						{
							memcpy(service->exiMsg.V2G_Message.Body.MeteringReceiptReq->PEVID.data, service->val.string.codepoints,service->val.string.len*sizeof(uint32_t));
						service->exiMsg.V2G_Message.Body.MeteringReceiptReq->PEVID.arraylen.data = service->val.string.len;
						service->exiMsg.V2G_Message.Body.MeteringReceiptReq->isused.PEVID=1;
						}


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 110: /*ServiceScope*/
		if(service->val.type == STRING) 
					{
						memcpy(service->exiMsg.V2G_Message.Body.ServiceDiscoveryReq->ServiceScope.data, service->val.string.codepoints,service->val.string.len*sizeof(uint32_t));
						service->exiMsg.V2G_Message.Body.ServiceDiscoveryReq->ServiceScope.arraylen.data = service->val.string.len;
						service->exiMsg.V2G_Message.Body.ServiceDiscoveryReq->isused.ServiceScope=1;


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 112: /*ServiceType*/
		if(service->val.type == ENUMERATION) 
					{
						service->exiMsg.V2G_Message.Body.ServiceDiscoveryReq->ServiceType = service->val.enumeration;
						service->exiMsg.V2G_Message.Body.ServiceDiscoveryReq->isused.ServiceType=1;


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 104: /*ServiceID*/
		if(service->val.type == BINARY_HEX) 
					{
						memcpy(service->exiMsg.V2G_Message.Body.ServiceDetailReq->ServiceID.data, service->val.binary.data,service->val.binary.len);
						service->exiMsg.V2G_Message.Body.ServiceDetailReq->ServiceID.arraylen.data = service->val.binary.len;


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 95: /*SelectedPaymentOption*/
		if(service->val.type == ENUMERATION) 
					{
						service->exiMsg.V2G_Message.Body.ServicePaymentSelectionReq->SelectedPaymentOption = service->val.enumeration;


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 30: /*ContractID*/
		if(service->val.type == STRING) 
					{
						if( service->idPath.id[2] == 75)
						{
							memcpy(service->exiMsg.V2G_Message.Body.PaymentDetailsReq->ContractID.data, service->val.string.codepoints,service->val.string.len*sizeof(uint32_t));
						service->exiMsg.V2G_Message.Body.PaymentDetailsReq->ContractID.arraylen.data = service->val.string.len;

						} else if(service->idPath.id[2] == 11)
						{
							memcpy(service->exiMsg.V2G_Message.Body.CertificateUpdateReq->ContractID.data, service->val.string.codepoints,service->val.string.len*sizeof(uint32_t));
						service->exiMsg.V2G_Message.Body.CertificateUpdateReq->ContractID.arraylen.data = service->val.string.len;
						}


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 51: /*GenChallenge*/
		if(service->val.type == STRING) 
					{
						memcpy(service->exiMsg.V2G_Message.Body.ContractAuthenticationReq->GenChallenge.data, service->val.string.codepoints,service->val.string.len*sizeof(uint32_t));
						service->exiMsg.V2G_Message.Body.ContractAuthenticationReq->GenChallenge.arraylen.data = service->val.string.len;


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 73: /*PEVRequestedEnergyTransferType*/
		if(service->val.type == ENUMERATION) 
					{
						service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->PEVRequestedEnergyTransferType = service->val.enumeration;


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 119: /*Tariff*/
		if(service->val.type == INTEGER) 
					{
						_setInt16Value( &(service->val.integer),&(service->val.integer.val.int16));
						if( service->idPath.id[2] == 80)
						{
							service->exiMsg.V2G_Message.Body.PowerDeliveryReq->Tariff = service->val.integer.val.int16;
						service->exiMsg.V2G_Message.Body.PowerDeliveryReq->isused.Tariff=1;

						} else if(service->idPath.id[2] == 57)
						{
							service->exiMsg.V2G_Message.Body.MeteringReceiptReq->Tariff = service->val.integer.val.int16;
						}


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 92: /*ReqSwitchStatus*/
		if(service->val.type == BOOLEAN) 
					{
						service->exiMsg.V2G_Message.Body.PowerDeliveryReq->ReqSwitchStatus = service->val.boolean;


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 41: /*EVSEID*/
		if(service->val.type == BINARY_HEX) 
					{
						memcpy(service->exiMsg.V2G_Message.Body.MeteringReceiptReq->EVSEID.data, service->val.binary.data,service->val.binary.len);
						service->exiMsg.V2G_Message.Body.MeteringReceiptReq->EVSEID.arraylen.data = service->val.binary.len;


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 113: /*SessionID*/
		if(service->val.type == BINARY_HEX) 
					{
						if( service->idPath.id[1] == 4)
						{
							memcpy(service->exiMsg.V2G_Message.Header->SessionInformation.SessionID.data, service->val.binary.data,service->val.binary.len);
						service->exiMsg.V2G_Message.Header->SessionInformation.SessionID.arraylen.data = service->val.binary.len;

						} else if(service->idPath.id[1] == 0)
						{
							memcpy(service->exiMsg.V2G_Message.Body.MeteringReceiptReq->SessionID.data, service->val.binary.data,service->val.binary.len);
						service->exiMsg.V2G_Message.Body.MeteringReceiptReq->SessionID.arraylen.data = service->val.binary.len;
						}


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 118: /*TCurrent*/
		if(service->val.type == INTEGER) 
					{
						_setInt32Value( &(service->val.integer),&(service->exiMsg.V2G_Message.Body.MeteringReceiptReq->TCurrent));
						service->exiMsg.V2G_Message.Body.MeteringReceiptReq->isused.TCurrent=1;


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 88: /*ReceiptSignature*/
		if(service->val.type == BINARY_BASE64) 
					{
						memcpy(service->exiMsg.V2G_Message.Body.MeteringReceiptReq->ReceiptSignature.data, service->val.binary.data,service->val.binary.len);
						service->exiMsg.V2G_Message.Body.MeteringReceiptReq->ReceiptSignature.arraylen.data = service->val.binary.len;


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 27: /*ContractEncryptionCert*/
		if(service->val.type == BINARY_BASE64) 
					{
						memcpy(service->exiMsg.V2G_Message.Body.CertificateUpdateReq->ContractEncryptionCert.data, service->val.binary.data,service->val.binary.len);
						service->exiMsg.V2G_Message.Body.CertificateUpdateReq->ContractEncryptionCert.arraylen.data = service->val.binary.len;


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 65: /*OEMProvisioningCert*/
		if(service->val.type == BINARY_BASE64) 
					{
						memcpy(service->exiMsg.V2G_Message.Body.CertificateInstallationReq->OEMProvisioningCert.data, service->val.binary.data,service->val.binary.len);
						service->exiMsg.V2G_Message.Body.CertificateInstallationReq->OEMProvisioningCert.arraylen.data = service->val.binary.len;


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 91: /*ReqLockStatus*/
		if(service->val.type == BOOLEAN) 
					{
						service->exiMsg.V2G_Message.Body.LineLockReq->ReqLockStatus = service->val.boolean;


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 2: /*BulkChargingComplete*/
		if(service->val.type == BOOLEAN) 
					{
						if( service->idPath.id[2] == 33)
						{
							service->exiMsg.V2G_Message.Body.CurrentDemandReq->BulkChargingComplete = service->val.boolean;
						service->exiMsg.V2G_Message.Body.CurrentDemandReq->isused.BulkChargingComplete=1;

						} else if(service->idPath.id[3] == 32)
						{
							service->exiMsg.V2G_Message.Body.PowerDeliveryReq->DC_PEVPowerDeliveryParameter->BulkChargingComplete = service->val.boolean;
						service->exiMsg.V2G_Message.Body.PowerDeliveryReq->DC_PEVPowerDeliveryParameter->isused.BulkChargingComplete=1;
						}


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 21: /*ChargingComplete*/
		if(service->val.type == BOOLEAN) 
					{
						if( service->idPath.id[2] == 33)
						{
							service->exiMsg.V2G_Message.Body.CurrentDemandReq->ChargingComplete = service->val.boolean;

						} else if(service->idPath.id[3] == 32)
						{
							service->exiMsg.V2G_Message.Body.PowerDeliveryReq->DC_PEVPowerDeliveryParameter->ChargingComplete = service->val.boolean;
						}


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;	
			} /* close switch(service->eqn.localPart) */	
		break;
		case 6:
			switch(service->eqn.localPart) {
				case 132: /*SessionID*/
		if(service->val.type == BINARY_HEX) 
					{
						if( service->idPath.id[1] == 4)
						{
							memcpy(service->exiMsg.V2G_Message.Header->SessionInformation.SessionID.data, service->val.binary.data,service->val.binary.len);
						service->exiMsg.V2G_Message.Header->SessionInformation.SessionID.arraylen.data = service->val.binary.len;

						} else if(service->idPath.id[1] == 0)
						{
							memcpy(service->exiMsg.V2G_Message.Body.MeteringReceiptReq->SessionID.data, service->val.binary.data,service->val.binary.len);
						service->exiMsg.V2G_Message.Body.MeteringReceiptReq->SessionID.arraylen.data = service->val.binary.len;
						}


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 127: /*ServiceSessionID*/
		if(service->val.type == BINARY_HEX) 
					{
						memcpy(service->exiMsg.V2G_Message.Header->SessionInformation.ServiceSessionID.data, service->val.binary.data,service->val.binary.len);
						service->exiMsg.V2G_Message.Header->SessionInformation.ServiceSessionID.arraylen.data = service->val.binary.len;
						service->exiMsg.V2G_Message.Header->SessionInformation.isused.ServiceSessionID=1;


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 107: /*ProtocolVersion*/
		if(service->val.type == STRING) 
					{
						memcpy(service->exiMsg.V2G_Message.Header->SessionInformation.ProtocolVersion.data, service->val.string.codepoints,service->val.string.len*sizeof(uint32_t));
						service->exiMsg.V2G_Message.Header->SessionInformation.ProtocolVersion.arraylen.data = service->val.string.len;
						service->exiMsg.V2G_Message.Header->SessionInformation.isused.ProtocolVersion=1;


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 67: /*FaultCode*/
		if(service->val.type == ENUMERATION) 
					{
						service->exiMsg.V2G_Message.Header->Notification.FaultCode = service->val.enumeration;
						service->exiMsg.V2G_Message.Header->Notification.isused.FaultCode=1;


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 68: /*FaultMsg*/
		if(service->val.type == STRING) 
					{
						memcpy(service->exiMsg.V2G_Message.Header->Notification.FaultMsg.data, service->val.string.codepoints,service->val.string.len*sizeof(uint32_t));
						service->exiMsg.V2G_Message.Header->Notification.FaultMsg.arraylen.data = service->val.string.len;
						service->exiMsg.V2G_Message.Header->Notification.isused.FaultMsg=1;


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 13: /*Certificate*/
		if(service->val.type == BINARY_BASE64) 
					{
						if( service->idPath.id[3] == 31)
						{
							memcpy(service->exiMsg.V2G_Message.Body.CertificateUpdateReq->ContractSignatureCertChain.Certificate.data, service->val.binary.data,service->val.binary.len);
						service->exiMsg.V2G_Message.Body.CertificateUpdateReq->ContractSignatureCertChain.Certificate.arraylen.data = service->val.binary.len;

						} else if(service->idPath.id[2] == 75)
						{
				/*			memcpy(service->exiMsg.V2G_Message.Body.PaymentDetailsReq->ContractSignatureCertChain.SubCertificates.Certificate.data, service->val.binary.data,service->val.binary.len);
						service->exiMsg.V2G_Message.Body.PaymentDetailsReq->ContractSignatureCertChain.SubCertificates.Certificate.arraylen.data = service->val.binary.len; */

						} else if(service->idPath.id[2] == 11)
						{
							/* memcpy(service->exiMsg.V2G_Message.Body.CertificateUpdateReq->ContractSignatureCertChain.SubCertificates.Certificate.data, service->val.binary.data,service->val.binary.len);
						service->exiMsg.V2G_Message.Body.CertificateUpdateReq->ContractSignatureCertChain.SubCertificates.Certificate.arraylen.data = service->val.binary.len; */
						}


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 21: /*ConnectorLocked*/
		if(service->val.type == BOOLEAN) 
					{
						if( service->idPath.id[3] == 8 && service->idPath.id[2] == 61)
						{
							service->exiMsg.V2G_Message.Body.MeteringStatusReq->AC_PEVStatus->ConnectorLocked = service->val.boolean;

						} else if(service->idPath.id[3] == 8 && service->idPath.id[2] == 57)
						{
							service->exiMsg.V2G_Message.Body.MeteringReceiptReq->AC_PEVStatus->ConnectorLocked = service->val.boolean;

						} else if(service->idPath.id[3] == 1)
						{
							service->exiMsg.V2G_Message.Body.LineLockReq->AC_PEVStatus.ConnectorLocked = service->val.boolean;

						} else if(service->idPath.id[3] == 35 && service->idPath.id[2] == 61)
						{
							service->exiMsg.V2G_Message.Body.MeteringStatusReq->DC_PEVStatus->ConnectorLocked = service->val.boolean;

						} else if(service->idPath.id[3] == 35 && service->idPath.id[2] == 57)
						{
							service->exiMsg.V2G_Message.Body.MeteringReceiptReq->DC_PEVStatus->ConnectorLocked = service->val.boolean;

						} else if(service->idPath.id[3] == 39 && service->idPath.id[2] == 3)
						{
							service->exiMsg.V2G_Message.Body.CableCheckReq->DC_PEVStatus.ConnectorLocked = service->val.boolean;

						} else if(service->idPath.id[3] == 39 && service->idPath.id[2] == 84)
						{
							service->exiMsg.V2G_Message.Body.PreChargeReq->DC_PEVStatus.ConnectorLocked = service->val.boolean;

						} else if(service->idPath.id[3] == 39 && service->idPath.id[2] == 33)
						{
							service->exiMsg.V2G_Message.Body.CurrentDemandReq->DC_PEVStatus.ConnectorLocked = service->val.boolean;

						} else if(service->idPath.id[3] == 39 && service->idPath.id[2] == 126)
						{
							service->exiMsg.V2G_Message.Body.WeldingDetectionReq->DC_PEVStatus.ConnectorLocked = service->val.boolean;

						} else if(service->idPath.id[3] == 39 && service->idPath.id[2] == 121)
						{
							service->exiMsg.V2G_Message.Body.TerminateChargingReq->DC_PEVStatus.ConnectorLocked = service->val.boolean;

						} else if(service->idPath.id[3] == 4)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->AC_PEVChargeParameter->AC_PEVStatus.ConnectorLocked = service->val.boolean;

						} else if(service->idPath.id[3] == 30)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->DC_PEVChargeParameter->DC_PEVStatus.ConnectorLocked = service->val.boolean;

						}else if(service->idPath.id[3] == 6)
						{
							service->exiMsg.V2G_Message.Body.PowerDeliveryReq->AC_PEVPowerDeliveryParameter->AC_PEVStatus.ConnectorLocked = service->val.boolean;

						} else if(service->idPath.id[3] == 32)
						{
							service->exiMsg.V2G_Message.Body.PowerDeliveryReq->DC_PEVPowerDeliveryParameter->DC_PEVStatus.ConnectorLocked = service->val.boolean;
						}


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 98: /*PEVStandby*/
		if(service->val.type == BOOLEAN) 
					{
						if( service->idPath.id[3] == 8 && service->idPath.id[2] == 61)
						{
							service->exiMsg.V2G_Message.Body.MeteringStatusReq->AC_PEVStatus->PEVStandby = service->val.boolean;

						} else if(service->idPath.id[3] == 8 && service->idPath.id[2] == 57)
						{
							service->exiMsg.V2G_Message.Body.MeteringReceiptReq->AC_PEVStatus->PEVStandby = service->val.boolean;

						} else if(service->idPath.id[3] == 1)
						{
							service->exiMsg.V2G_Message.Body.LineLockReq->AC_PEVStatus.PEVStandby = service->val.boolean;

						} else if(service->idPath.id[3] == 35 && service->idPath.id[2] == 61)
						{
							service->exiMsg.V2G_Message.Body.MeteringStatusReq->DC_PEVStatus->PEVStandby = service->val.boolean;

						} else if(service->idPath.id[3] == 35 && service->idPath.id[2] == 57)
						{
							service->exiMsg.V2G_Message.Body.MeteringReceiptReq->DC_PEVStatus->PEVStandby = service->val.boolean;

						} else if(service->idPath.id[3] == 39 && service->idPath.id[2] == 3)
						{
							service->exiMsg.V2G_Message.Body.CableCheckReq->DC_PEVStatus.PEVStandby = service->val.boolean;

						} else if(service->idPath.id[3] == 39 && service->idPath.id[2] == 84)
						{
							service->exiMsg.V2G_Message.Body.PreChargeReq->DC_PEVStatus.PEVStandby = service->val.boolean;

						} else if(service->idPath.id[3] == 39 && service->idPath.id[2] == 33)
						{
							service->exiMsg.V2G_Message.Body.CurrentDemandReq->DC_PEVStatus.PEVStandby = service->val.boolean;

						} else if(service->idPath.id[3] == 39 && service->idPath.id[2] == 126)
						{
							service->exiMsg.V2G_Message.Body.WeldingDetectionReq->DC_PEVStatus.PEVStandby = service->val.boolean;

						} else if(service->idPath.id[3] == 39 && service->idPath.id[2] == 121)
						{
							service->exiMsg.V2G_Message.Body.TerminateChargingReq->DC_PEVStatus.PEVStandby = service->val.boolean;

						} else if(service->idPath.id[3] == 4 && service->idPath.id[5] == 98)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->AC_PEVChargeParameter->AC_PEVStatus.PEVStandby = service->val.boolean;

						} else if(service->idPath.id[3] == 30)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->DC_PEVChargeParameter->DC_PEVStatus.PEVStandby = service->val.boolean;

						} else if(service->idPath.id[3] == 6)
						{
							service->exiMsg.V2G_Message.Body.PowerDeliveryReq->AC_PEVPowerDeliveryParameter->AC_PEVStatus.PEVStandby = service->val.boolean;

						} else if(service->idPath.id[3] == 32)
						{
							service->exiMsg.V2G_Message.Body.PowerDeliveryReq->DC_PEVPowerDeliveryParameter->DC_PEVStatus.PEVStandby = service->val.boolean;
						}


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 77: /*Multiplier*/
		if(service->val.type == NBIT_UNSIGNED_INTEGER)
					{
						if( service->idPath.id[3] == 72)
						{
							service->exiMsg.V2G_Message.Body.PreChargeReq->PEVRESSVoltage.Multiplier = service->val.integer.val.int8;

						} else if(service->idPath.id[3] == 74 && service->idPath.id[2] == 84)
						{
							service->exiMsg.V2G_Message.Body.PreChargeReq->PEVTargetVoltage.Multiplier = service->val.integer.val.int8;

						} else if(service->idPath.id[3] == 67)
						{
							service->exiMsg.V2G_Message.Body.PreChargeReq->PEVDemandCurrent.Multiplier = service->val.integer.val.int8;

						} else if(service->idPath.id[3] == 125 && service->idPath.id[2] == 84)
						{
							service->exiMsg.V2G_Message.Body.PreChargeReq->VoltageDifferential.Multiplier = service->val.integer.val.int8;

						} else if(service->idPath.id[3] == 15)
						{
							service->exiMsg.V2G_Message.Body.CurrentDemandReq->ChargeCurrentRequest.Multiplier = service->val.integer.val.int8;

						} else if(service->idPath.id[3] == 71)
						{
							service->exiMsg.V2G_Message.Body.CurrentDemandReq->PEVMaximumVoltageLimit.Multiplier = service->val.integer.val.int8;

						} else if(service->idPath.id[3] == 69)
						{
							service->exiMsg.V2G_Message.Body.CurrentDemandReq->PEVMaximumCurrentLimit.Multiplier = service->val.integer.val.int8;

						} else if(service->idPath.id[3] == 70)
						{
							service->exiMsg.V2G_Message.Body.CurrentDemandReq->PEVMaximumPowerLimit.Multiplier = service->val.integer.val.int8;

						} else if(service->idPath.id[3] == 90)
						{
							service->exiMsg.V2G_Message.Body.CurrentDemandReq->RemainingTimeToFullSoC.Multiplier = service->val.integer.val.int8;

						} else if(service->idPath.id[3] == 89)
						{
							service->exiMsg.V2G_Message.Body.CurrentDemandReq->RemainingTimeToBulkSoC.Multiplier = service->val.integer.val.int8;

						} else if(service->idPath.id[3] == 74 && service->idPath.id[2] == 33)
						{
							service->exiMsg.V2G_Message.Body.CurrentDemandReq->PEVTargetVoltage.Multiplier = service->val.integer.val.int8;

						} else if(service->idPath.id[3] == 37)
						{
							service->exiMsg.V2G_Message.Body.CurrentDemandReq->CurrentDifferential.Multiplier = service->val.integer.val.int8;

						} else if(service->idPath.id[3] == 125 && service->idPath.id[2] == 33)
						{
							service->exiMsg.V2G_Message.Body.CurrentDemandReq->VoltageDifferential.Multiplier = service->val.integer.val.int8;

						} else if(service->idPath.id[4] == 39)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->AC_PEVChargeParameter->EAmount.Multiplier = service->val.integer.val.int8;

						} else if(service->idPath.id[4] == 85)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->AC_PEVChargeParameter->PEVMaxPower.Multiplier = service->val.integer.val.int8;

						} else if(service->idPath.id[4] == 86)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->AC_PEVChargeParameter->PEVMaxVoltage.Multiplier = service->val.integer.val.int8;

						} else if(service->idPath.id[4] == 91)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->AC_PEVChargeParameter->PEVMinVoltage.Multiplier = service->val.integer.val.int8;

						} else if(service->idPath.id[4] == 83)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->AC_PEVChargeParameter->PEVMaxCurrent.Multiplier = service->val.integer.val.int8;

						} else if(service->idPath.id[4] == 90)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->AC_PEVChargeParameter->PEVMinCurrent.Multiplier = service->val.integer.val.int8;

						} else if(service->idPath.id[4] == 87)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->DC_PEVChargeParameter->PEVMaximumCurrentLimit.Multiplier = service->val.integer.val.int8;

						} else if(service->idPath.id[4] == 88)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->DC_PEVChargeParameter->PEVMaximumPowerLimit.Multiplier = service->val.integer.val.int8;

						} else if(service->idPath.id[4] == 89)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->DC_PEVChargeParameter->PEVMaximumVoltageLimit.Multiplier = service->val.integer.val.int8;

						} else if(service->idPath.id[4] == 81)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->DC_PEVChargeParameter->PEVEnergyCapacity.Multiplier = service->val.integer.val.int8;

						} else if(service->idPath.id[4] == 82)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->DC_PEVChargeParameter->PEVEnergyRequest.Multiplier = service->val.integer.val.int8;

						} else if(service->idPath.id[4] == 75)
						{
							service->exiMsg.V2G_Message.Body.MeteringReceiptReq->MeterInfo.MeterReading.Multiplier = service->val.integer.val.int8;
						}


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 151: /*Unit*/
		if(service->val.type == ENUMERATION) 
					{
						if( service->idPath.id[3] == 72)
						{
							service->exiMsg.V2G_Message.Body.PreChargeReq->PEVRESSVoltage.Unit = service->val.enumeration;

						} else if(service->idPath.id[3] == 74 && service->idPath.id[2] == 84)
						{
							service->exiMsg.V2G_Message.Body.PreChargeReq->PEVTargetVoltage.Unit = service->val.enumeration;

						} else if(service->idPath.id[3] == 67)
						{
							service->exiMsg.V2G_Message.Body.PreChargeReq->PEVDemandCurrent.Unit = service->val.enumeration;

						} else if(service->idPath.id[3] == 125 && service->idPath.id[2] == 84)
						{
							service->exiMsg.V2G_Message.Body.PreChargeReq->VoltageDifferential.Unit = service->val.enumeration;

						} else if(service->idPath.id[3] == 15)
						{
							service->exiMsg.V2G_Message.Body.CurrentDemandReq->ChargeCurrentRequest.Unit = service->val.enumeration;

						} else if(service->idPath.id[3] == 71)
						{
							service->exiMsg.V2G_Message.Body.CurrentDemandReq->PEVMaximumVoltageLimit.Unit = service->val.enumeration;

						} else if(service->idPath.id[3] == 69)
						{
							service->exiMsg.V2G_Message.Body.CurrentDemandReq->PEVMaximumCurrentLimit.Unit = service->val.enumeration;

						} else if(service->idPath.id[3] == 70)
						{
							service->exiMsg.V2G_Message.Body.CurrentDemandReq->PEVMaximumPowerLimit.Unit = service->val.enumeration;

						} else if(service->idPath.id[3] == 90)
						{
							service->exiMsg.V2G_Message.Body.CurrentDemandReq->RemainingTimeToFullSoC.Unit = service->val.enumeration;

						} else if(service->idPath.id[3] == 89)
						{
							service->exiMsg.V2G_Message.Body.CurrentDemandReq->RemainingTimeToBulkSoC.Unit = service->val.enumeration;

						} else if(service->idPath.id[3] == 74 && service->idPath.id[2] == 33)
						{
							service->exiMsg.V2G_Message.Body.CurrentDemandReq->PEVTargetVoltage.Unit = service->val.enumeration;

						} else if(service->idPath.id[3] == 37)
						{
							service->exiMsg.V2G_Message.Body.CurrentDemandReq->CurrentDifferential.Unit = service->val.enumeration;

						} else if(service->idPath.id[3] == 125 && service->idPath.id[2] == 33)
						{
							service->exiMsg.V2G_Message.Body.CurrentDemandReq->VoltageDifferential.Unit = service->val.enumeration;

						} else if(service->idPath.id[4] == 39)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->AC_PEVChargeParameter->EAmount.Unit = service->val.enumeration;

						} else if(service->idPath.id[4] == 85)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->AC_PEVChargeParameter->PEVMaxPower.Unit = service->val.enumeration;

						} else if(service->idPath.id[4] == 86)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->AC_PEVChargeParameter->PEVMaxVoltage.Unit = service->val.enumeration;

						} else if(service->idPath.id[4] == 91)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->AC_PEVChargeParameter->PEVMinVoltage.Unit = service->val.enumeration;

						} else if(service->idPath.id[4] == 83)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->AC_PEVChargeParameter->PEVMaxCurrent.Unit = service->val.enumeration;

						} else if(service->idPath.id[4] == 90)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->AC_PEVChargeParameter->PEVMinCurrent.Unit = service->val.enumeration;

						} else if(service->idPath.id[4] == 87)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->DC_PEVChargeParameter->PEVMaximumCurrentLimit.Unit = service->val.enumeration;

						} else if(service->idPath.id[4] == 88)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->DC_PEVChargeParameter->PEVMaximumPowerLimit.Unit = service->val.enumeration;

						} else if(service->idPath.id[4] == 89)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->DC_PEVChargeParameter->PEVMaximumVoltageLimit.Unit = service->val.enumeration;

						} else if(service->idPath.id[4] == 81)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->DC_PEVChargeParameter->PEVEnergyCapacity.Unit = service->val.enumeration;

						} else if(service->idPath.id[4] == 82)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->DC_PEVChargeParameter->PEVEnergyRequest.Unit = service->val.enumeration;

						} else if(service->idPath.id[4] == 75)
						{
							service->exiMsg.V2G_Message.Body.MeteringReceiptReq->MeterInfo.MeterReading.Unit = service->val.enumeration;
						}


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 152: /*Value*/
		if(service->val.type == INTEGER) 
					{

						_setInt16Value( &(service->val.integer),&(service->val.integer.val.int16));

						if( service->idPath.id[3] == 72)
						{
							service->exiMsg.V2G_Message.Body.PreChargeReq->PEVRESSVoltage.Value = service->val.integer.val.int16;

						} else if(service->idPath.id[3] == 74 && service->idPath.id[2] == 84)
						{
							service->exiMsg.V2G_Message.Body.PreChargeReq->PEVTargetVoltage.Value = service->val.integer.val.int16;

						} else if(service->idPath.id[3] == 67)
						{
							service->exiMsg.V2G_Message.Body.PreChargeReq->PEVDemandCurrent.Value = service->val.integer.val.int16;

						} else if(service->idPath.id[3] == 125 && service->idPath.id[2] == 84)
						{
							service->exiMsg.V2G_Message.Body.PreChargeReq->VoltageDifferential.Value = service->val.integer.val.int16;

						} else if(service->idPath.id[3] == 15)
						{
							service->exiMsg.V2G_Message.Body.CurrentDemandReq->ChargeCurrentRequest.Value = service->val.integer.val.int16;

						} else if(service->idPath.id[3] == 71)
						{
							service->exiMsg.V2G_Message.Body.CurrentDemandReq->PEVMaximumVoltageLimit.Value = service->val.integer.val.int16;

						} else if(service->idPath.id[3] == 69)
						{
							service->exiMsg.V2G_Message.Body.CurrentDemandReq->PEVMaximumCurrentLimit.Value = service->val.integer.val.int16;

						} else if(service->idPath.id[3] == 70)
						{
							service->exiMsg.V2G_Message.Body.CurrentDemandReq->PEVMaximumPowerLimit.Value = service->val.integer.val.int16;

						} else if(service->idPath.id[3] == 90)
						{
							service->exiMsg.V2G_Message.Body.CurrentDemandReq->RemainingTimeToFullSoC.Value = service->val.integer.val.int16;

						} else if(service->idPath.id[3] == 89)
						{
							service->exiMsg.V2G_Message.Body.CurrentDemandReq->RemainingTimeToBulkSoC.Value = service->val.integer.val.int16;

						} else if(service->idPath.id[3] == 74 && service->idPath.id[2] == 33)
						{
							service->exiMsg.V2G_Message.Body.CurrentDemandReq->PEVTargetVoltage.Value = service->val.integer.val.int16;

						} else if(service->idPath.id[3] == 37)
						{
							service->exiMsg.V2G_Message.Body.CurrentDemandReq->CurrentDifferential.Value = service->val.integer.val.int16;

						} else if(service->idPath.id[3] == 125 && service->idPath.id[2] == 33)
						{
							service->exiMsg.V2G_Message.Body.CurrentDemandReq->VoltageDifferential.Value = service->val.integer.val.int16;

						} else if(service->idPath.id[4] == 39)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->AC_PEVChargeParameter->EAmount.Value = service->val.integer.val.int16;

						} else if(service->idPath.id[4] == 85)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->AC_PEVChargeParameter->PEVMaxPower.Value = service->val.integer.val.int16;

						} else if(service->idPath.id[4] == 86)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->AC_PEVChargeParameter->PEVMaxVoltage.Value = service->val.integer.val.int16;

						} else if(service->idPath.id[4] == 91)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->AC_PEVChargeParameter->PEVMinVoltage.Value = service->val.integer.val.int16;

						} else if(service->idPath.id[4] == 83)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->AC_PEVChargeParameter->PEVMaxCurrent.Value = service->val.integer.val.int16;

						} else if(service->idPath.id[4] == 90)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->AC_PEVChargeParameter->PEVMinCurrent.Value = service->val.integer.val.int16;

						} else if(service->idPath.id[4] == 87)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->DC_PEVChargeParameter->PEVMaximumCurrentLimit.Value = service->val.integer.val.int16;

						} else if(service->idPath.id[4] == 88)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->DC_PEVChargeParameter->PEVMaximumPowerLimit.Value = service->val.integer.val.int16;

						} else if(service->idPath.id[4] == 89)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->DC_PEVChargeParameter->PEVMaximumVoltageLimit.Value = service->val.integer.val.int16;

						} else if(service->idPath.id[4] == 81)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->DC_PEVChargeParameter->PEVEnergyCapacity.Value = service->val.integer.val.int16;

						} else if(service->idPath.id[4] == 82)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->DC_PEVChargeParameter->PEVEnergyRequest.Value = service->val.integer.val.int16;

						} else if(service->idPath.id[4] == 75)
						{
							service->exiMsg.V2G_Message.Body.MeteringReceiptReq->MeterInfo.MeterReading.Value = service->val.integer.val.int16;
						}


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 66: /*EoC*/
		if(service->val.type == INTEGER) 
					{
						_setInt32Value( &(service->val.integer),&(service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->AC_PEVChargeParameter->EoC));


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 84: /*PEVMaxPhases*/
		if(service->val.type == NBIT_UNSIGNED_INTEGER)
					{
						service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->AC_PEVChargeParameter->PEVMaxPhases = service->val.integer.val.int8;


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 96: /*PEVReady*/
		if(service->val.type == BOOLEAN) 
					{
						if( service->idPath.id[2] == 61)
						{
							service->exiMsg.V2G_Message.Body.MeteringStatusReq->DC_PEVStatus->PEVReady = service->val.boolean;

						} else if(service->idPath.id[2] == 57)
						{
							service->exiMsg.V2G_Message.Body.MeteringReceiptReq->DC_PEVStatus->PEVReady = service->val.boolean;

						} else if(service->idPath.id[2] == 3)
						{
							service->exiMsg.V2G_Message.Body.CableCheckReq->DC_PEVStatus.PEVReady = service->val.boolean;

						} else if(service->idPath.id[2] == 84)
						{
							service->exiMsg.V2G_Message.Body.PreChargeReq->DC_PEVStatus.PEVReady = service->val.boolean;

						} else if(service->idPath.id[2] == 33)
						{
							service->exiMsg.V2G_Message.Body.CurrentDemandReq->DC_PEVStatus.PEVReady = service->val.boolean;

						} else if(service->idPath.id[2] == 126)
						{
							service->exiMsg.V2G_Message.Body.WeldingDetectionReq->DC_PEVStatus.PEVReady = service->val.boolean;

						} else if(service->idPath.id[2] == 121)
						{
							service->exiMsg.V2G_Message.Body.TerminateChargingReq->DC_PEVStatus.PEVReady = service->val.boolean;

						} else if(service->idPath.id[2] == 16)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->DC_PEVChargeParameter->DC_PEVStatus.PEVReady = service->val.boolean;

						} else if(service->idPath.id[2] == 80)
						{
							service->exiMsg.V2G_Message.Body.PowerDeliveryReq->DC_PEVPowerDeliveryParameter->DC_PEVStatus.PEVReady = service->val.boolean;
						}


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 100: /*PEVStatusCode*/
		if(service->val.type == ENUMERATION) 
					{
						if( service->idPath.id[2] == 61)
						{
							service->exiMsg.V2G_Message.Body.MeteringStatusReq->DC_PEVStatus->PEVStatusCode = service->val.enumeration;

						} else if(service->idPath.id[2] == 57)
						{
							service->exiMsg.V2G_Message.Body.MeteringReceiptReq->DC_PEVStatus->PEVStatusCode = service->val.enumeration;

						} else if(service->idPath.id[2] == 3)
						{
							service->exiMsg.V2G_Message.Body.CableCheckReq->DC_PEVStatus.PEVStatusCode = service->val.enumeration;

						} else if(service->idPath.id[2] == 84)
						{
							service->exiMsg.V2G_Message.Body.PreChargeReq->DC_PEVStatus.PEVStatusCode = service->val.enumeration;

						} else if(service->idPath.id[2] == 33)
						{
							service->exiMsg.V2G_Message.Body.CurrentDemandReq->DC_PEVStatus.PEVStatusCode = service->val.enumeration;

						} else if(service->idPath.id[2] == 126)
						{
							service->exiMsg.V2G_Message.Body.WeldingDetectionReq->DC_PEVStatus.PEVStatusCode = service->val.enumeration;

						} else if(service->idPath.id[2] == 121)
						{
							service->exiMsg.V2G_Message.Body.TerminateChargingReq->DC_PEVStatus.PEVStatusCode = service->val.enumeration;

						} else if(service->idPath.id[2] == 16)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->DC_PEVChargeParameter->DC_PEVStatus.PEVStatusCode = service->val.enumeration;

						} else if(service->idPath.id[2] == 80)
						{
							service->exiMsg.V2G_Message.Body.PowerDeliveryReq->DC_PEVPowerDeliveryParameter->DC_PEVStatus.PEVStatusCode = service->val.enumeration;
						}


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 95: /*PEVRESSSOC*/
		if(service->val.type == NBIT_UNSIGNED_INTEGER)
					{
						if( service->idPath.id[2] == 61)
						{
							service->exiMsg.V2G_Message.Body.MeteringStatusReq->DC_PEVStatus->PEVRESSSOC = service->val.integer.val.int8;

						} else if(service->idPath.id[2] == 57)
						{
							service->exiMsg.V2G_Message.Body.MeteringReceiptReq->DC_PEVStatus->PEVRESSSOC = service->val.integer.val.int8;

						} else if(service->idPath.id[2] == 3)
						{
							service->exiMsg.V2G_Message.Body.CableCheckReq->DC_PEVStatus.PEVRESSSOC = service->val.integer.val.int8;

						} else if(service->idPath.id[2] == 84)
						{
							service->exiMsg.V2G_Message.Body.PreChargeReq->DC_PEVStatus.PEVRESSSOC = service->val.integer.val.int8;

						} else if(service->idPath.id[2] == 33)
						{
							service->exiMsg.V2G_Message.Body.CurrentDemandReq->DC_PEVStatus.PEVRESSSOC = service->val.integer.val.int8;

						} else if(service->idPath.id[2] == 126)
						{
							service->exiMsg.V2G_Message.Body.WeldingDetectionReq->DC_PEVStatus.PEVRESSSOC = service->val.integer.val.int8;

						} else if(service->idPath.id[2] == 121)
						{
							service->exiMsg.V2G_Message.Body.TerminateChargingReq->DC_PEVStatus.PEVRESSSOC = service->val.integer.val.int8;

						} else if(service->idPath.id[2] == 16)
						{
							service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->DC_PEVChargeParameter->DC_PEVStatus.PEVRESSSOC = service->val.integer.val.int8;

						} else if(service->idPath.id[2] == 80)
						{
							service->exiMsg.V2G_Message.Body.PowerDeliveryReq->DC_PEVPowerDeliveryParameter->DC_PEVStatus.PEVRESSSOC = service->val.integer.val.int8;
						}


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 71: /*FullSOC*/
		if(service->val.type == NBIT_UNSIGNED_INTEGER)
					{
						service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->DC_PEVChargeParameter->FullSOC = service->val.integer.val.int8;
						service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->DC_PEVChargeParameter->isused.FullSOC=1;


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 12: /*BulkSOC*/
		if(service->val.type == NBIT_UNSIGNED_INTEGER)
					{
						service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->DC_PEVChargeParameter->BulkSOC = service->val.integer.val.int8;
						service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->DC_PEVChargeParameter->isused.BulkSOC=1;


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 94: /*PEVProtocolVersion*/
		if(service->val.type == NBIT_UNSIGNED_INTEGER)
					{
						service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->DC_PEVChargeParameter->PEVProtocolVersion = service->val.integer.val.int8;


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 19: /*ChargingProfileEntryStart*/
		if(service->val.type == INTEGER) 
					{
						_setInt32Value( &(service->val.integer),&(service->exiMsg.V2G_Message.Body.PowerDeliveryReq->ChargingProfile.ProfileEntry[service->exiMsg.V2G_Message.Body.PowerDeliveryReq->ChargingProfile.arraylen.ProfileEntry].ChargingProfileEntryStart));


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 18: /*ChargingProfileEntryMaxPower*/
		if(service->val.type == INTEGER) 
					{
						service->exiMsg.V2G_Message.Body.PowerDeliveryReq->ChargingProfile.ProfileEntry[service->exiMsg.V2G_Message.Body.PowerDeliveryReq->ChargingProfile.arraylen.ProfileEntry].ChargingProfileEntryMaxPower = service->val.integer.val.int16;


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 11: /*BulkChargingComplete*/
		if(service->val.type == BOOLEAN) 
					{
						if( service->idPath.id[2] == 33)
						{
							service->exiMsg.V2G_Message.Body.CurrentDemandReq->BulkChargingComplete = service->val.boolean;
						service->exiMsg.V2G_Message.Body.CurrentDemandReq->isused.BulkChargingComplete=1;

						} else if(service->idPath.id[3] == 32)
						{
							service->exiMsg.V2G_Message.Body.PowerDeliveryReq->DC_PEVPowerDeliveryParameter->BulkChargingComplete = service->val.boolean;
						service->exiMsg.V2G_Message.Body.PowerDeliveryReq->DC_PEVPowerDeliveryParameter->isused.BulkChargingComplete=1;
						}


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 17: /*ChargingComplete*/
		if(service->val.type == BOOLEAN) 
					{
						if( service->idPath.id[2] == 33)
						{
							service->exiMsg.V2G_Message.Body.CurrentDemandReq->ChargingComplete = service->val.boolean;

						} else if(service->idPath.id[3] == 32)
						{
							service->exiMsg.V2G_Message.Body.PowerDeliveryReq->DC_PEVPowerDeliveryParameter->ChargingComplete = service->val.boolean;
						}


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 72: /*MeterID*/
		if(service->val.type == STRING) 
					{
						memcpy(service->exiMsg.V2G_Message.Body.MeteringReceiptReq->MeterInfo.MeterID.data, service->val.string.codepoints,service->val.string.len*sizeof(uint32_t));
						service->exiMsg.V2G_Message.Body.MeteringReceiptReq->MeterInfo.MeterID.arraylen.data = service->val.string.len;
						service->exiMsg.V2G_Message.Body.MeteringReceiptReq->MeterInfo.isused.MeterID=1;


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 74: /*MeterPubKey*/
		if(service->val.type == BINARY_BASE64) 
					{
						memcpy(service->exiMsg.V2G_Message.Body.MeteringReceiptReq->MeterInfo.MeterPubKey.data, service->val.binary.data,service->val.binary.len);
						service->exiMsg.V2G_Message.Body.MeteringReceiptReq->MeterInfo.MeterPubKey.arraylen.data = service->val.binary.len;
						service->exiMsg.V2G_Message.Body.MeteringReceiptReq->MeterInfo.isused.MeterPubKey=1;


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 76: /*MeterStatus*/
		if(service->val.type == INTEGER) 
					{
						_setInt16Value( &(service->val.integer),&(service->val.integer.val.int16));
						service->exiMsg.V2G_Message.Body.MeteringReceiptReq->MeterInfo.MeterStatus = service->val.integer.val.int16;
						service->exiMsg.V2G_Message.Body.MeteringReceiptReq->MeterInfo.isused.MeterStatus=1;


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;
				case 139: /*TMeter*/
		if(service->val.type == INTEGER) 
					{
						_setInt32Value( &(service->val.integer),&(service->exiMsg.V2G_Message.Body.MeteringReceiptReq->MeterInfo.TMeter));
						service->exiMsg.V2G_Message.Body.MeteringReceiptReq->MeterInfo.isused.TMeter=1;


					} 
					else
					{
						return -1; /* wrong data type */
					}

				break;	
			} /* close switch(service->eqn.localPart) */	
		break;
	
	} /* close switch(service->eqn.namespaceURI) */
	return 0;
}

/**
 * Deserialize an attribute of the EXI stream
 * @return 0 = 0K; -1 = ERROR
 */
static int deserializeAttributeCharacter(struct EXIService* service)
{
	switch(service->eqn.namespaceURI) {
			case 0:
				switch(service->eqn.localPart) {

					case 2:/* Id */
				if(service->val.type == STRING)
					{


						memcpy(service->exiMsg.V2G_Message.Header->Security.Signature->attr_Id.data, service->val.string.codepoints,service->val.string.len*sizeof(uint32_t));
						service->exiMsg.V2G_Message.Header->Security.Signature->attr_Id.arraylen.data = service->val.string.len;
					}

					else
					{
						return -1; /* wrong data type */
					}

					break;
					case 0:/* Algorithm */
						if(service->val.type == STRING)
							{
							if( service->idPath.id[5] == 0)
									{
							memcpy(service->exiMsg.V2G_Message.Header->Security.Signature->SignedInfo.CanonicalizationMethod.attr_Algorithm.data, service->val.string.codepoints,service->val.string.len*sizeof(uint32_t));
							service->exiMsg.V2G_Message.Header->Security.Signature->SignedInfo.CanonicalizationMethod.attr_Algorithm.arraylen.data = service->val.string.len;
							}
							else if( service->idPath.id[5] == 43)
							{

								memcpy(service->exiMsg.V2G_Message.Header->Security.Signature->SignedInfo.SignatureMethod.attr_Algorithm.data, service->val.string.codepoints,service->val.string.len*sizeof(uint32_t));
								service->exiMsg.V2G_Message.Header->Security.Signature->SignedInfo.SignatureMethod.attr_Algorithm.arraylen.data = service->val.string.len;
							}
							else if( service->idPath.id[6] == 5)
							{

								memcpy(service->exiMsg.V2G_Message.Header->Security.Signature->SignedInfo.Reference.DigestMethod.attr_Algorithm.data, service->val.string.codepoints,service->val.string.len*sizeof(uint32_t));
								service->exiMsg.V2G_Message.Header->Security.Signature->SignedInfo.Reference.DigestMethod.attr_Algorithm.arraylen.data = service->val.string.len;
							}
						}
						break;
						case 6:/* URI */
							if(service->val.type == STRING)
								{

								memcpy(service->exiMsg.V2G_Message.Header->Security.Signature->SignedInfo.Reference.attr_URI.data, service->val.string.codepoints,service->val.string.len*sizeof(uint32_t));
								service->exiMsg.V2G_Message.Header->Security.Signature->SignedInfo.Reference.attr_URI.arraylen.data = service->val.string.len;

							}
						break;
				}
			break;
	}

	return 0;
}

/**
 * Depending on the current EXI event a message element is deserialized or a
 * defined service method is called in here
 */
static int deserializeElementOrServiceCall(struct EXIService* service)
{

	switch(service->eqn.namespaceURI) {
		case 0:
			switch(service->eqn.localPart) {
			}
		break;
		case 4:
			switch(service->eqn.localPart) {

				case 14:/* KeyInfo */	
	
 					service->exiMsg.V2G_Message.Header->Security.Signature->isused.KeyInfo=1;

				break;
				case 42:/* Signature */	
	
 					service->exiMsg.V2G_Message.Header->Security.isused.Signature=1;

				break;
			}
		break;
		case 5:
			switch(service->eqn.localPart) {
				case 22:/* ChargingProfile */	
	
 					service->exiMsg.V2G_Message.Body.PowerDeliveryReq->isused.ChargingProfile=1;

				break;
				case 71:/* PEVMaximumVoltageLimit */	
	
 					service->exiMsg.V2G_Message.Body.CurrentDemandReq->isused.PEVMaximumVoltageLimit=1;

				break;
				case 69:/* PEVMaximumCurrentLimit */	
	
 					service->exiMsg.V2G_Message.Body.CurrentDemandReq->isused.PEVMaximumCurrentLimit=1;

				break;
				case 70:/* PEVMaximumPowerLimit */	
	
 					service->exiMsg.V2G_Message.Body.CurrentDemandReq->isused.PEVMaximumPowerLimit=1;

				break;
				case 90:/* RemainingTimeToFullSoC */	
	
 					service->exiMsg.V2G_Message.Body.CurrentDemandReq->isused.RemainingTimeToFullSoC=1;

				break;
				case 89:/* RemainingTimeToBulkSoC */	
	
 					service->exiMsg.V2G_Message.Body.CurrentDemandReq->isused.RemainingTimeToBulkSoC=1;

				break;
				case 114:/* SessionSetupReq */	
	
 		
			
							
					/* test, if data length is unequal to the expected payload  */
					/*if((service->inStream.size)!= *(service->inStream.pos))
					{
						service->errorCode = EXI_NON_VALID_MESSAGE;
						return -1;
					}	*/		
			
					/* service call */
					sessionSetup((service->exiMsg.V2G_Message.Header),(service->exiMsg.V2G_Message.Body.SessionSetupReq), (service->exiMsg.V2G_Message.Body.SessionSetupRes));
							
					/* signalize the response message */
					service->exiMsg.V2G_Message.Body.isused.SessionSetupRes=1;
					service->exiMsg.V2G_Message.Body.isused.SessionSetupReq=0;
					
					/* serialize the response data */
					if(serialize_message(service))
					{
						/* serializiation error*/
						service->errorCode= EXI_SERIALIZATION_FAILED;
					} 

			
		
				break;
				case 100:/* ServiceDiscoveryReq */	
	
 		
			
							
					/* test, if data length is unequal to the expected payload  */
					/*if((service->inStream.size)!= *(service->inStream.pos))
					{
						service->errorCode = EXI_NON_VALID_MESSAGE;
						return -1;
					}	*/		
			
					/* service call */
					serviceDiscovery((service->exiMsg.V2G_Message.Header),(service->exiMsg.V2G_Message.Body.ServiceDiscoveryReq), (service->exiMsg.V2G_Message.Body.ServiceDiscoveryRes));
							
					/* signalize the response message */
					service->exiMsg.V2G_Message.Body.isused.ServiceDiscoveryRes=1;
					service->exiMsg.V2G_Message.Body.isused.ServiceDiscoveryReq=0;
					
					/* serialize the response data */
					if(serialize_message(service))
					{
						/* serializiation error*/
						service->errorCode= EXI_SERIALIZATION_FAILED;
					} 

			
		
				break;
				case 96:/* ServiceDetailReq */	
	
 		
			
							
					/* test, if data length is unequal to the expected payload  */
					/*if((service->inStream.size)!= *(service->inStream.pos))
					{
						service->errorCode = EXI_NON_VALID_MESSAGE;
						return -1;
					}	*/		
			
					/* service call */
					serviceDetail((service->exiMsg.V2G_Message.Header),(service->exiMsg.V2G_Message.Body.ServiceDetailReq), (service->exiMsg.V2G_Message.Body.ServiceDetailRes));
							
					/* signalize the response message */
					service->exiMsg.V2G_Message.Body.isused.ServiceDetailRes=1;
					service->exiMsg.V2G_Message.Body.isused.ServiceDetailReq=0;
					
					/* serialize the response data */
					if(serialize_message(service))
					{
						/* serializiation error*/
						service->errorCode= EXI_SERIALIZATION_FAILED;
					} 

			
		
				break;
				case 106:/* ServicePaymentSelectionReq */	
	
 		
			
							
					/* test, if data length is unequal to the expected payload  */
					/*if((service->inStream.size)!= *(service->inStream.pos))
					{
						service->errorCode = EXI_NON_VALID_MESSAGE;
						return -1;
					}	*/		
			
					/* service call */
					selectedServicePayment((service->exiMsg.V2G_Message.Header),(service->exiMsg.V2G_Message.Body.ServicePaymentSelectionReq), (service->exiMsg.V2G_Message.Body.ServicePaymentSelectionRes));
							
					/* signalize the response message */
					service->exiMsg.V2G_Message.Body.isused.ServicePaymentSelectionRes=1;
					service->exiMsg.V2G_Message.Body.isused.ServicePaymentSelectionReq=0;
					
					/* serialize the response data */
					if(serialize_message(service))
					{
						/* serializiation error*/
						service->errorCode= EXI_SERIALIZATION_FAILED;
					} 

			
		
				break;
				case 75:/* PaymentDetailsReq */	
	
 		
			
							
					/* test, if data length is unequal to the expected payload  */
					/*if((service->inStream.size)!= *(service->inStream.pos))
					{
						service->errorCode = EXI_NON_VALID_MESSAGE;
						return -1;
					}	*/		
			
					/* service call */
					paymentDetails((service->exiMsg.V2G_Message.Header),(service->exiMsg.V2G_Message.Body.PaymentDetailsReq), (service->exiMsg.V2G_Message.Body.PaymentDetailsRes));
							
					/* signalize the response message */
					service->exiMsg.V2G_Message.Body.isused.PaymentDetailsRes=1;
					service->exiMsg.V2G_Message.Body.isused.PaymentDetailsReq=0;
					
					/* serialize the response data */
					if(serialize_message(service))
					{
						/* serializiation error*/
						service->errorCode= EXI_SERIALIZATION_FAILED;
					} 

			
		
				break;
				case 23:/* ContractAuthenticationReq */	
	
 		
			
							
					/* test, if data length is unequal to the expected payload  */
					/*if((service->inStream.size)!= *(service->inStream.pos))
					{
						service->errorCode = EXI_NON_VALID_MESSAGE;
						return -1;
					}	*/		
			
					/* service call */
					contractAuthentication((service->exiMsg.V2G_Message.Header),(service->exiMsg.V2G_Message.Body.ContractAuthenticationReq), (service->exiMsg.V2G_Message.Body.ContractAuthenticationRes));
							
					/* signalize the response message */
					service->exiMsg.V2G_Message.Body.isused.ContractAuthenticationRes=1;
					service->exiMsg.V2G_Message.Body.isused.ContractAuthenticationReq=0;
					
					/* serialize the response data */
					if(serialize_message(service))
					{
						/* serializiation error*/
						service->errorCode= EXI_SERIALIZATION_FAILED;
					} 

			
		
				break;
				case 16:/* ChargeParameterDiscoveryReq */	
	
 		
			
							
					/* test, if data length is unequal to the expected payload  */
					/*if((service->inStream.size)!= *(service->inStream.pos))
					{
						service->errorCode = EXI_NON_VALID_MESSAGE;
						return -1;
					}	*/		
			
					/* service call */
					chargeParameterDiscovery((service->exiMsg.V2G_Message.Header),(service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq), (service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryRes));
							
					/* signalize the response message */
					service->exiMsg.V2G_Message.Body.isused.ChargeParameterDiscoveryRes=1;
					service->exiMsg.V2G_Message.Body.isused.ChargeParameterDiscoveryReq=0;
					
					/* serialize the response data */
					if(serialize_message(service))
					{
						/* serializiation error*/
						service->errorCode= EXI_SERIALIZATION_FAILED;
					} 

			
		
				break;
				case 80:/* PowerDeliveryReq */	
	
 		
			
							
					/* test, if data length is unequal to the expected payload  */
					/*if((service->inStream.size)!= *(service->inStream.pos))
					{
						service->errorCode = EXI_NON_VALID_MESSAGE;
						return -1;
					}	*/		
			
					/* service call */
					powerDelivery((service->exiMsg.V2G_Message.Header),(service->exiMsg.V2G_Message.Body.PowerDeliveryReq), (service->exiMsg.V2G_Message.Body.PowerDeliveryRes));
							
					/* signalize the response message */
					service->exiMsg.V2G_Message.Body.isused.PowerDeliveryRes=1;
					service->exiMsg.V2G_Message.Body.isused.PowerDeliveryReq=0;
					
					/* serialize the response data */
					if(serialize_message(service))
					{
						/* serializiation error*/
						service->errorCode= EXI_SERIALIZATION_FAILED;
					} 

			
		
				break;
				case 61:/* MeteringStatusReq */	
	
 		
			
							
					/* test, if data length is unequal to the expected payload  */
					/*if((service->inStream.size)!= *(service->inStream.pos))
					{
						service->errorCode = EXI_NON_VALID_MESSAGE;
						return -1;
					}	*/		
			
					/* service call */
					meteringStatus((service->exiMsg.V2G_Message.Header),(service->exiMsg.V2G_Message.Body.MeteringStatusReq), (service->exiMsg.V2G_Message.Body.MeteringStatusRes));
							
					/* signalize the response message */
					service->exiMsg.V2G_Message.Body.isused.MeteringStatusRes=1;
					service->exiMsg.V2G_Message.Body.isused.MeteringStatusReq=0;
					
					/* serialize the response data */
					if(serialize_message(service))
					{
						/* serializiation error*/
						service->errorCode= EXI_SERIALIZATION_FAILED;
					} 

			
		
				break;
				case 57:/* MeteringReceiptReq */	
	
 		
			
							
					/* test, if data length is unequal to the expected payload  */
					/*if((service->inStream.size)!= *(service->inStream.pos))
					{
						service->errorCode = EXI_NON_VALID_MESSAGE;
						return -1;
					}	*/		
			
					/* service call */
					meteringReceipt((service->exiMsg.V2G_Message.Header),(service->exiMsg.V2G_Message.Body.MeteringReceiptReq), (service->exiMsg.V2G_Message.Body.MeteringReceiptRes));
							
					/* signalize the response message */
					service->exiMsg.V2G_Message.Body.isused.MeteringReceiptRes=1;
					service->exiMsg.V2G_Message.Body.isused.MeteringReceiptReq=0;
					
					/* serialize the response data */
					if(serialize_message(service))
					{
						/* serializiation error*/
						service->errorCode= EXI_SERIALIZATION_FAILED;
					} 

			
		
				break;
				case 11:/* CertificateUpdateReq */	
	
 		
			
							
					/* test, if data length is unequal to the expected payload  */
					/*if((service->inStream.size)!= *(service->inStream.pos))
					{
						service->errorCode = EXI_NON_VALID_MESSAGE;
						return -1;
					}	*/		
			
					/* service call */
					certificateUpdate((service->exiMsg.V2G_Message.Header),(service->exiMsg.V2G_Message.Body.CertificateUpdateReq), (service->exiMsg.V2G_Message.Body.CertificateUpdateRes));
							
					/* signalize the response message */
					service->exiMsg.V2G_Message.Body.isused.CertificateUpdateRes=1;
					service->exiMsg.V2G_Message.Body.isused.CertificateUpdateReq=0;
					
					/* serialize the response data */
					if(serialize_message(service))
					{
						/* serializiation error*/
						service->errorCode= EXI_SERIALIZATION_FAILED;
					} 

			
		
				break;
				case 7:/* CertificateInstallationReq */	
	
 		
			
							
					/* test, if data length is unequal to the expected payload  */
					/*if((service->inStream.size)!= *(service->inStream.pos))
					{
						service->errorCode = EXI_NON_VALID_MESSAGE;
						return -1;
					}	*/		
			
					/* service call */
					certificateInstallation((service->exiMsg.V2G_Message.Header),(service->exiMsg.V2G_Message.Body.CertificateInstallationReq), (service->exiMsg.V2G_Message.Body.CertificateInstallationRes));
							
					/* signalize the response message */
					service->exiMsg.V2G_Message.Body.isused.CertificateInstallationRes=1;
					service->exiMsg.V2G_Message.Body.isused.CertificateInstallationReq=0;
					
					/* serialize the response data */
					if(serialize_message(service))
					{
						/* serializiation error*/
						service->errorCode= EXI_SERIALIZATION_FAILED;
					} 

			
		
				break;
				case 52:/* LineLockReq */	
	
 		
			
							
					/* test, if data length is unequal to the expected payload  */
					/*if((service->inStream.size)!= *(service->inStream.pos))
					{
						service->errorCode = EXI_NON_VALID_MESSAGE;
						return -1;
					}	*/		
			
					/* service call */
					lineLock((service->exiMsg.V2G_Message.Header),(service->exiMsg.V2G_Message.Body.LineLockReq), (service->exiMsg.V2G_Message.Body.LineLockRes));
							
					/* signalize the response message */
					service->exiMsg.V2G_Message.Body.isused.LineLockRes=1;
					service->exiMsg.V2G_Message.Body.isused.LineLockReq=0;
					
					/* serialize the response data */
					if(serialize_message(service))
					{
						/* serializiation error*/
						service->errorCode= EXI_SERIALIZATION_FAILED;
					} 

			
		
				break;
				case 3:/* CableCheckReq */	
	
 		
			
							
					/* test, if data length is unequal to the expected payload  */
					/*if((service->inStream.size)!= *(service->inStream.pos))
					{
						service->errorCode = EXI_NON_VALID_MESSAGE;
						return -1;
					}	*/		
			
					/* service call */
					cableCheck((service->exiMsg.V2G_Message.Header),(service->exiMsg.V2G_Message.Body.CableCheckReq), (service->exiMsg.V2G_Message.Body.CableCheckRes));
							
					/* signalize the response message */
					service->exiMsg.V2G_Message.Body.isused.CableCheckRes=1;
					service->exiMsg.V2G_Message.Body.isused.CableCheckReq=0;
					
					/* serialize the response data */
					if(serialize_message(service))
					{
						/* serializiation error*/
						service->errorCode= EXI_SERIALIZATION_FAILED;
					} 

			
		
				break;
				case 84:/* PreChargeReq */	
	
 		
			
							
					/* test, if data length is unequal to the expected payload  */
					/*if((service->inStream.size)!= *(service->inStream.pos))
					{
						service->errorCode = EXI_NON_VALID_MESSAGE;
						return -1;
					}	*/		
			
					/* service call */
					preCharge((service->exiMsg.V2G_Message.Header),(service->exiMsg.V2G_Message.Body.PreChargeReq), (service->exiMsg.V2G_Message.Body.PreChargeRes));
							
					/* signalize the response message */
					service->exiMsg.V2G_Message.Body.isused.PreChargeRes=1;
					service->exiMsg.V2G_Message.Body.isused.PreChargeReq=0;
					
					/* serialize the response data */
					if(serialize_message(service))
					{
						/* serializiation error*/
						service->errorCode= EXI_SERIALIZATION_FAILED;
					} 

			
		
				break;
				case 33:/* CurrentDemandReq */	
	
 		
			
							
					/* test, if data length is unequal to the expected payload  */
					/*if((service->inStream.size)!= *(service->inStream.pos))
					{
						service->errorCode = EXI_NON_VALID_MESSAGE;
						return -1;
					}	*/		
			
					/* service call */
					currentDemand((service->exiMsg.V2G_Message.Header),(service->exiMsg.V2G_Message.Body.CurrentDemandReq), (service->exiMsg.V2G_Message.Body.CurrentDemandRes));
							
					/* signalize the response message */
					service->exiMsg.V2G_Message.Body.isused.CurrentDemandRes=1;
					service->exiMsg.V2G_Message.Body.isused.CurrentDemandReq=0;
					
					/* serialize the response data */
					if(serialize_message(service))
					{
						/* serializiation error*/
						service->errorCode= EXI_SERIALIZATION_FAILED;
					} 

			
		
				break;
				case 126:/* WeldingDetectionReq */	
	
 		
			
							
					/* test, if data length is unequal to the expected payload  */
					/*if((service->inStream.size)!= *(service->inStream.pos))
					{
						service->errorCode = EXI_NON_VALID_MESSAGE;
						return -1;
					}	*/		
			
					/* service call */
					weldingDetection((service->exiMsg.V2G_Message.Header),(service->exiMsg.V2G_Message.Body.WeldingDetectionReq), (service->exiMsg.V2G_Message.Body.WeldingDetectionRes));
							
					/* signalize the response message */
					service->exiMsg.V2G_Message.Body.isused.WeldingDetectionRes=1;
					service->exiMsg.V2G_Message.Body.isused.WeldingDetectionReq=0;
					
					/* serialize the response data */
					if(serialize_message(service))
					{
						/* serializiation error*/
						service->errorCode= EXI_SERIALIZATION_FAILED;
					} 

			
		
				break;
				case 121:/* TerminateChargingReq */	
	
 		
			
							
					/* test, if data length is unequal to the expected payload  */
					/*if((service->inStream.size)!= *(service->inStream.pos))
					{
						service->errorCode = EXI_NON_VALID_MESSAGE;
						return -1;
					}	*/		
			
					/* service call */
					terminateCharging((service->exiMsg.V2G_Message.Header),(service->exiMsg.V2G_Message.Body.TerminateChargingReq), (service->exiMsg.V2G_Message.Body.TerminateChargingRes));
							
					/* signalize the response message */
					service->exiMsg.V2G_Message.Body.isused.TerminateChargingRes=1;
					service->exiMsg.V2G_Message.Body.isused.TerminateChargingReq=0;
					
					/* serialize the response data */
					if(serialize_message(service))
					{
						/* serializiation error*/
						service->errorCode= EXI_SERIALIZATION_FAILED;
					} 

			
		
				break;
			}
		break;
		case 6:
			switch(service->eqn.localPart) {
				case 110:/* Service */	
	
 					service->exiMsg.V2G_Message.Body.ServicePaymentSelectionReq->ServiceList.arraylen.Service++;

				break;
				case 137:/* SubCertificates */	
	
 		if( service->idPath.id[2] == 75)
				{
								service->exiMsg.V2G_Message.Body.PaymentDetailsReq->ContractSignatureCertChain.isused.SubCertificates=1;

				} else if(service->idPath.id[2] == 11)
				{
								service->exiMsg.V2G_Message.Body.CertificateUpdateReq->ContractSignatureCertChain.isused.SubCertificates=1;
				}

				break;
				case 88:/* PEVMaximumPowerLimit */	
	
 					service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->DC_PEVChargeParameter->isused.PEVMaximumPowerLimit=1;

				break;
				case 81:/* PEVEnergyCapacity */	
	
 					service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->DC_PEVChargeParameter->isused.PEVEnergyCapacity=1;

				break;
				case 82:/* PEVEnergyRequest */	
	
 					service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->DC_PEVChargeParameter->isused.PEVEnergyRequest=1;

				break;
				case 4:/* AC_PEVChargeParameter */	
	
 					service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->isused.AC_PEVChargeParameter=1;

				break;
				case 30:/* DC_PEVChargeParameter */	
	
 					service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq->isused.DC_PEVChargeParameter=1;

				break;
				case 105:/* ProfileEntry */	
	
 					service->exiMsg.V2G_Message.Body.PowerDeliveryReq->ChargingProfile.arraylen.ProfileEntry++;

				break;
				case 6:/* AC_PEVPowerDeliveryParameter */	
	
 					service->exiMsg.V2G_Message.Body.PowerDeliveryReq->isused.AC_PEVPowerDeliveryParameter=1;

				break;
				case 32:/* DC_PEVPowerDeliveryParameter */	
	
 					service->exiMsg.V2G_Message.Body.PowerDeliveryReq->isused.DC_PEVPowerDeliveryParameter=1;

				break;
				case 8:/* AC_PEVStatus */	
	
 		if( service->idPath.id[2] == 61)
				{
								service->exiMsg.V2G_Message.Body.MeteringStatusReq->isused.AC_PEVStatus=1;

				} else if(service->idPath.id[2] == 57)
				{
								service->exiMsg.V2G_Message.Body.MeteringReceiptReq->isused.AC_PEVStatus=1;
				}

				break;
				case 35:/* DC_PEVStatus */	
	
 		if( service->idPath.id[2] == 61)
				{
								service->exiMsg.V2G_Message.Body.MeteringStatusReq->isused.DC_PEVStatus=1;

				} else if(service->idPath.id[2] == 57)
				{
								service->exiMsg.V2G_Message.Body.MeteringReceiptReq->isused.DC_PEVStatus=1;
				}

				break;
				case 75:/* MeterReading */	
	
 					service->exiMsg.V2G_Message.Body.MeteringReceiptReq->MeterInfo.isused.MeterReading=1;

				break;
				case 135:/* SigMeterReading */	
	
 					service->exiMsg.V2G_Message.Body.MeteringReceiptReq->MeterInfo.isused.SigMeterReading=1;

				break;
			}
		break;
		case 8:
			switch(service->eqn.localPart) {
				case 1:/* Notification */	
	
 					service->exiMsg.V2G_Message.Header->isused.Notification=1;

				break;
				case 2:/* Security */	
	
 					service->exiMsg.V2G_Message.Header->isused.Security=1;

				break;
			}
		break;
		

	}
	return 0;
}
static int deserializeSessionSetupReqMsg(struct EXIService* service)
{
	struct SessionSetupReqType reqMsg;
	struct SessionSetupResType resMsg;
	service->exiMsg.V2G_Message.Body.SessionSetupReq = &reqMsg;
	service->exiMsg.V2G_Message.Body.SessionSetupRes = &resMsg;
	
	return deserializeMessage(service);
}

static int deserializeServiceDiscoveryReqMsg(struct EXIService* service)
{
	struct ServiceDiscoveryReqType reqMsg;
	struct ServiceDiscoveryResType resMsg;
	init_ServiceDiscoveryReqType(&reqMsg);
	
	service->exiMsg.V2G_Message.Body.ServiceDiscoveryReq = &reqMsg;
	service->exiMsg.V2G_Message.Body.ServiceDiscoveryRes = &resMsg;
	
	return deserializeMessage(service);
}

static int deserializeServiceDetailReqMsg(struct EXIService* service)
{
	struct ServiceDetailReqType reqMsg;
	struct ServiceDetailResType resMsg;
	service->exiMsg.V2G_Message.Body.ServiceDetailReq = &reqMsg;
	service->exiMsg.V2G_Message.Body.ServiceDetailRes = &resMsg;
	
	return deserializeMessage(service);
}

static int deserializeServicePaymentSelectionReqMsg(struct EXIService* service)
{
	struct ServicePaymentSelectionReqType reqMsg;
	struct ServicePaymentSelectionResType resMsg;
	service->exiMsg.V2G_Message.Body.ServicePaymentSelectionReq = &reqMsg;
	service->exiMsg.V2G_Message.Body.ServicePaymentSelectionRes = &resMsg;
	
	return deserializeMessage(service);
}

static int deserializePaymentDetailsReqMsg(struct EXIService* service)
{
	struct PaymentDetailsReqType reqMsg;
	struct PaymentDetailsResType resMsg;
	init_PaymentDetailsReqType(&reqMsg);
	
	service->exiMsg.V2G_Message.Body.PaymentDetailsReq = &reqMsg;
	service->exiMsg.V2G_Message.Body.PaymentDetailsRes = &resMsg;
	
	return deserializeMessage(service);
}

static int deserializeContractAuthenticationReqMsg(struct EXIService* service)
{
	struct ContractAuthenticationReqType reqMsg;
	struct ContractAuthenticationResType resMsg;
	service->exiMsg.V2G_Message.Body.ContractAuthenticationReq = &reqMsg;
	service->exiMsg.V2G_Message.Body.ContractAuthenticationRes = &resMsg;
	
	return deserializeMessage(service);
}

static int deserializeChargeParameterDiscoveryReqMsg(struct EXIService* service)
{
	struct ChargeParameterDiscoveryReqType reqMsg;
	struct ChargeParameterDiscoveryResType resMsg;
	struct DC_PEVChargeParameterType dc_pev;
	struct AC_PEVChargeParameterType ac_pev;
	struct DC_EVSEChargeParameterType dc_evse;
	struct AC_EVSEChargeParameterType ac_evse;

	init_ChargeParameterDiscoveryReqType(&reqMsg);
	init_DC_EVSEChargeParameterType(&dc_evse);
	init_AC_EVSEChargeParameterType(&ac_evse);
	init_DC_PEVChargeParameterType(&dc_pev);
	init_AC_PEVChargeParameterType(&ac_pev);
	
	reqMsg.AC_PEVChargeParameter = &ac_pev;
	reqMsg.DC_PEVChargeParameter = &dc_pev;
	resMsg.AC_EVSEChargeParameter = &ac_evse;
	resMsg.DC_EVSEChargeParameter= &dc_evse;

	service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryReq = &reqMsg;
	service->exiMsg.V2G_Message.Body.ChargeParameterDiscoveryRes = &resMsg;
	
	return deserializeMessage(service);
}

static int deserializeLineLockReqMsg(struct EXIService* service)
{
	struct LineLockReqType reqMsg;
	struct LineLockResType resMsg;
	init_LineLockReqType(&reqMsg);
	
	service->exiMsg.V2G_Message.Body.LineLockReq = &reqMsg;
	service->exiMsg.V2G_Message.Body.LineLockRes = &resMsg;
	
	return deserializeMessage(service);
}

static int deserializePowerDeliveryReqMsg(struct EXIService* service)
{
	struct PowerDeliveryReqType reqMsg;
	struct PowerDeliveryResType resMsg;
	struct DC_PEVPowerDeliveryParameterType dc_pev;
	struct AC_PEVPowerDeliveryParameterType ac_pev;
	struct DC_EVSEStatusType dc_evse;
	struct AC_EVSEStatusType ac_evse;

	init_PowerDeliveryReqType(&reqMsg);
	init_DC_PEVPowerDeliveryParameterType(&dc_pev);
	init_AC_PEVPowerDeliveryParameterType(&ac_pev);

	reqMsg.AC_PEVPowerDeliveryParameter = &ac_pev;
	reqMsg.DC_PEVPowerDeliveryParameter = &dc_pev;
	resMsg.AC_EVSEStatus = &ac_evse;
	resMsg.DC_EVSEStatus = &dc_evse;

	service->exiMsg.V2G_Message.Body.PowerDeliveryReq = &reqMsg;
	service->exiMsg.V2G_Message.Body.PowerDeliveryRes = &resMsg;
	
	return deserializeMessage(service);
}

static int deserializeMeteringStatusReqMsg(struct EXIService* service)
{
	struct MeteringStatusReqType reqMsg;
	struct MeteringStatusResType resMsg;
	struct DC_PEVStatusType dc_pev;
	struct AC_PEVStatusType ac_pev;
	struct DC_EVSEStatusType dc_evse;
	struct AC_EVSEStatusType ac_evse;

	reqMsg.AC_PEVStatus=&ac_pev;
	reqMsg.DC_PEVStatus=&dc_pev;
	resMsg.DC_EVSEStatus=&dc_evse;
	resMsg.AC_EVSEStatus=&ac_evse;

	init_MeteringStatusReqType(&reqMsg);

	service->exiMsg.V2G_Message.Body.MeteringStatusReq = &reqMsg;
	service->exiMsg.V2G_Message.Body.MeteringStatusRes = &resMsg;
	
	return deserializeMessage(service);
}

static int deserializeMeteringReceiptReqMsg(struct EXIService* service)
{
	struct MeteringReceiptReqType reqMsg;
	struct MeteringReceiptResType resMsg;
	struct DC_PEVStatusType dc_pev;
	struct AC_PEVStatusType ac_pev;
	struct DC_EVSEStatusType dc_evse;
	struct AC_EVSEStatusType ac_evse;

	reqMsg.AC_PEVStatus=&ac_pev;
	reqMsg.DC_PEVStatus=&dc_pev;
	resMsg.DC_EVSEStatus=&dc_evse;
	resMsg.AC_EVSEStatus=&ac_evse;

	init_MeteringReceiptReqType(&reqMsg);
	
	service->exiMsg.V2G_Message.Body.MeteringReceiptReq = &reqMsg;
	service->exiMsg.V2G_Message.Body.MeteringReceiptRes = &resMsg;
	
	return deserializeMessage(service);
}

static int deserializeCertificateUpdateReqMsg(struct EXIService* service)
{
	struct CertificateUpdateReqType reqMsg;
	struct CertificateUpdateResType resMsg;
	init_CertificateUpdateReqType(&reqMsg);
	
	service->exiMsg.V2G_Message.Body.CertificateUpdateReq = &reqMsg;
	service->exiMsg.V2G_Message.Body.CertificateUpdateRes = &resMsg;
	
	return deserializeMessage(service);
}

static int deserializeCertificateInstallationReqMsg(struct EXIService* service)
{
	struct CertificateInstallationReqType reqMsg;
	struct CertificateInstallationResType resMsg;
	service->exiMsg.V2G_Message.Body.CertificateInstallationReq = &reqMsg;
	service->exiMsg.V2G_Message.Body.CertificateInstallationRes = &resMsg;
	
	return deserializeMessage(service);
}

static int deserializeCableCheckReqMsg(struct EXIService* service)
{
	struct CableCheckReqType reqMsg;
	struct CableCheckResType resMsg;
	service->exiMsg.V2G_Message.Body.CableCheckReq = &reqMsg;
	service->exiMsg.V2G_Message.Body.CableCheckRes = &resMsg;
	
	return deserializeMessage(service);
}

static int deserializePreChargeReqMsg(struct EXIService* service)
{
	struct PreChargeReqType reqMsg;
	struct PreChargeResType resMsg;
	init_PreChargeReqType(&reqMsg);
	
	service->exiMsg.V2G_Message.Body.PreChargeReq = &reqMsg;
	service->exiMsg.V2G_Message.Body.PreChargeRes = &resMsg;
	
	return deserializeMessage(service);
}

static int deserializeCurrentDemandReqMsg(struct EXIService* service)
{
	struct CurrentDemandReqType reqMsg;
	struct CurrentDemandResType resMsg;
	init_CurrentDemandReqType(&reqMsg);
	
	service->exiMsg.V2G_Message.Body.CurrentDemandReq = &reqMsg;
	service->exiMsg.V2G_Message.Body.CurrentDemandRes = &resMsg;
	
	return deserializeMessage(service);
}

static int deserializeWeldingDetectionReqMsg(struct EXIService* service)
{
	struct WeldingDetectionReqType reqMsg;
	struct WeldingDetectionResType resMsg;
	service->exiMsg.V2G_Message.Body.WeldingDetectionReq = &reqMsg;
	service->exiMsg.V2G_Message.Body.WeldingDetectionRes = &resMsg;
	
	return deserializeMessage(service);
}

static int deserializeTerminateChargingReqMsg(struct EXIService* service)
{
	struct TerminateChargingReqType reqMsg;
	struct TerminateChargingResType resMsg;
	service->exiMsg.V2G_Message.Body.TerminateChargingReq = &reqMsg;
	service->exiMsg.V2G_Message.Body.TerminateChargingRes = &resMsg;
	
	return deserializeMessage(service);
}
/** 
 * Deserialize the EXI stream
 * @return 0 = 0K; -1 = ERROR
 */
static int deserializeMessage(struct EXIService* service)
{
	int noEndOfDocument = 1; /* true */
	int returnCode=0;


	do {
			exiDecodeNextEvent(&(service->inStream), &(service->stateDecode), &(service->event));
			if (returnCode) 
			{
				
				if(service->errorCode==0) 
				{
					service->errorCode= EXI_NON_VALID_MESSAGE;
				}
			
				return returnCode;
			}

			switch (service->event) {
			case START_DOCUMENT:

				returnCode = exiDecodeStartDocument(&(service->inStream), &(service->stateDecode));

				break;
			case END_DOCUMENT:

				returnCode = exiDecodeEndDocument(&(service->inStream), &(service->stateDecode));
				noEndOfDocument = 0; /* false */
				break;
			case START_ELEMENT:
				returnCode = exiDecodeStartElement(&(service->inStream), &(service->stateDecode), &(service->eqn));
				service->idPath.id[service->idPath.pos++]=service->eqn.localPart;
				 
				 /* setup the request context*/
				 if(service->eqn.localPart==114 && service->eqn.namespaceURI==5)
				  {
				 	return deserializeSessionSetupReqMsg(service);
				   } else if(service->eqn.localPart==100 && service->eqn.namespaceURI==5)
				  {
				 	return deserializeServiceDiscoveryReqMsg(service);
				   } else if(service->eqn.localPart==96 && service->eqn.namespaceURI==5)
				  {
				 	return deserializeServiceDetailReqMsg(service);
				   } else if(service->eqn.localPart==106 && service->eqn.namespaceURI==5)
				  {
				 	return deserializeServicePaymentSelectionReqMsg(service);
				   } else if(service->eqn.localPart==75 && service->eqn.namespaceURI==5)
				  {
				 	return deserializePaymentDetailsReqMsg(service);
				   } else if(service->eqn.localPart==23 && service->eqn.namespaceURI==5)
				  {
				 	return deserializeContractAuthenticationReqMsg(service);
				   } else if(service->eqn.localPart==16 && service->eqn.namespaceURI==5)
				  {
				 	return deserializeChargeParameterDiscoveryReqMsg(service);
				   } else if(service->eqn.localPart==80 && service->eqn.namespaceURI==5)
				  {
				 	return deserializePowerDeliveryReqMsg(service);
				   } else if(service->eqn.localPart==61 && service->eqn.namespaceURI==5)
				  {
				 	return deserializeMeteringStatusReqMsg(service);
				   } else if(service->eqn.localPart==57 && service->eqn.namespaceURI==5)
				  {
				 	return deserializeMeteringReceiptReqMsg(service);
				   } else if(service->eqn.localPart==11 && service->eqn.namespaceURI==5)
				  {
				 	return deserializeCertificateUpdateReqMsg(service);
				   } else if(service->eqn.localPart==7 && service->eqn.namespaceURI==5)
				  {
				 	return deserializeCertificateInstallationReqMsg(service);
				   } else if(service->eqn.localPart==52 && service->eqn.namespaceURI==5)
				  {
				 	return deserializeLineLockReqMsg(service);
				   } else if(service->eqn.localPart==3 && service->eqn.namespaceURI==5)
				  {
				 	return deserializeCableCheckReqMsg(service);
				   } else if(service->eqn.localPart==84 && service->eqn.namespaceURI==5)
				  {
				 	return deserializePreChargeReqMsg(service);
				   } else if(service->eqn.localPart==33 && service->eqn.namespaceURI==5)
				  {
				 	return deserializeCurrentDemandReqMsg(service);
				   } else if(service->eqn.localPart==126 && service->eqn.namespaceURI==5)
				  {
				 	return deserializeWeldingDetectionReqMsg(service);
				   } else if(service->eqn.localPart==121 && service->eqn.namespaceURI==5)
				  {
				 	return deserializeTerminateChargingReqMsg(service);
				   } 				 
				 
				 
				break;
			case END_ELEMENT:

				returnCode = exiDecodeEndElement(&(service->inStream), &(service->stateDecode), &(service->eqn));
				returnCode = deserializeElementOrServiceCall(service);
				service->idPath.pos--;
				 
				break;
			case CHARACTERS:
				/* decode */
				returnCode = exiDecodeCharacters(&(service->inStream), &(service->stateDecode), &(service->val));
				 
				/* assign data to the EXI message structure */
				returnCode = deserializeElementCharacter(service);
				break;
			case ATTRIBUTE:
				/* decode */
				returnCode = exiDecodeAttribute(&(service->inStream), &(service->stateDecode), &(service->eqn), &(service->val));
				returnCode = deserializeAttributeCharacter(service);
				break;
			default:
				/* ERROR */
				return -1;
			}

		} while (noEndOfDocument);

	return 0;
}


/** 
 * \brief Takes the EXI stream, invokes the called service method, and provides the response EXI stream
 * \param	service   struct EXIService* Represent the service data structure
 * \param	inStream   uint8_t* EXI in stream
 * \param	sizeInStream   uint16_t Length of the inStream
 * \param	outStream   uint8_t* Represent the out stream
 * \param	sizeOutStream   uint16_t Size of the out stream
 * \param	outStreamLength   uint16_t* Length of the stream
 * \return  0 = 0K; -1 = ERROR
 */
int messageDispatcher(struct EXIService* service, uint8_t* inStream, uint16_t sizeInStream, uint8_t* outStream, uint16_t sizeOutStream, uint16_t* outStreamLength)
{
	struct MessageHeaderType header;
	struct SignatureType signature;

	uint32_t inPos, outPos;
	
	exi_name_table_runtime_t runtimeTableDecode;
	exi_name_table_runtime_t runtimeTableEncode;
	
	/* assign inStream data to service EXI structure */
	inPos = service->transportHeaderOffset;
	service->inStream.data = inStream;
	service->inStream.size = sizeInStream+inPos;
	service->inStream.pos = &inPos;
	service->inStream.buffer=0;
	service->inStream.capacity=0;

	
	/* assign outStream data to service EXI structure */
	outPos=service->transportHeaderOffset;
	service->outStream.data = outStream;
	service->outStream.size = sizeOutStream;
	service->outStream.pos = &outPos;
	service->outStream.buffer=0;
	service->outStream.capacity=8;
	
	/* clear error code */
	service->errorCode = 0;
	
	/* init decoder (read header, set initial state) */
	/* init runtime table */
	exiInitNameTableRuntime(&runtimeTableDecode);
	exiInitDecoder(&(service->inStream), &(service->stateDecode), runtimeTableDecode);
	
	/* init encoder (write header, set initial state) */
	exiInitNameTableRuntime(&runtimeTableEncode);
	exiInitEncoder(&(service->outStream), &(service->stateEncode), runtimeTableEncode);

	/* init uniqueID stack */
	service->idPath.pos=0;

	init_MessageHeaderType(&header);
	service->exiMsg.V2G_Message.Header = &header;
	service->exiMsg.V2G_Message.Header->Security.Signature=&signature;

	/* init EXI message */
	init_EXIDocumentType(&(service->exiMsg));

	/* deserialize the input stream and call the corresponding service */
	if(deserializeMessage(service))
	{
		return -1; /* something went wrong */
	}

	/* determine payload size (without transport offset) */	
	outPos -= service->transportHeaderOffset;
	*outStreamLength = outPos;

	
	return 0;
}

/** 
 * \brief Init the v2g service data structure
 * \param	service   struct EXIService* Service data structure
 * \param	bytes   bytes_t setted up byte data structure
 * \param	string_ucs_t   setted up string data structure
 * \param	transportHeaderOffset uint16_t Transport protocol offset
 * \return  0 = 0K; -1 = ERROR
 */
int init_v2gservice(struct EXIService* service, bytes_t bytes, string_ucs_t string, uint16_t transportHeaderOffset)
{

	/* init byte array */
	 service->val.binary = bytes;

	/* init string array */
	 service->val.string = string;

	/* init offset for transport protocoll */
	 service->transportHeaderOffset=transportHeaderOffset;

	return 0;
}
